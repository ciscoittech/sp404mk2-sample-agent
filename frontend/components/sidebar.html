<div class="drawer lg:drawer-open">
  <input id="sidebar-toggle" type="checkbox" class="drawer-toggle" />

  <!-- Content area -->
  <div class="drawer-content flex flex-col">
    <!-- Mobile hamburger button -->
    <div class="w-full navbar bg-base-300 lg:hidden">
      <div class="flex-none">
        <label for="sidebar-toggle" class="btn btn-square btn-ghost" aria-label="Open sidebar menu">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </label>
      </div>
      <div class="flex-1">
        <span class="text-xl font-bold">SP404MK2</span>
      </div>
    </div>

    <!-- Page content container -->
    <div id="page-content" class="flex-1">
      <!-- Page content will be injected here -->
    </div>
  </div>

  <!-- Sidebar -->
  <div class="drawer-side">
    <label for="sidebar-toggle" aria-label="close sidebar" class="drawer-overlay"></label>
    <aside class="menu p-4 w-64 min-h-full bg-base-200 text-base-content" aria-label="Main navigation">
      <!-- Logo/Brand -->
      <div class="mb-4 px-2">
        <h1 class="text-2xl font-bold text-primary">SP404MK2</h1>
        <p class="text-sm text-base-content/70">Sample Agent</p>
      </div>

      <!-- Global Search -->
      <div class="mb-4">
        <input type="search"
               id="global-search"
               placeholder="Search samples..."
               class="input input-bordered w-full input-sm"
               aria-label="Global sample search" />
      </div>

      <div class="divider"></div>

      <!-- Primary Navigation -->
      <ul class="space-y-1">
        <li>
          <a href="/" class="gap-2" aria-label="Dashboard">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="/pages/samples.html" class="gap-2" aria-label="Samples library">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
            </svg>
            <span>Samples</span>
            <span class="badge badge-sm" id="sample-count">0</span>
          </a>
        </li>
        <li>
          <a href="/pages/kits.html" class="gap-2" aria-label="Sample kits">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
            </svg>
            <span>Kits</span>
            <span class="badge badge-sm" id="kit-count">0</span>
          </a>
        </li>
        <li>
          <a href="/pages/batch.html" class="gap-2" aria-label="Batch processing">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <span>Batch</span>
          </a>
        </li>
        <li>
          <a href="/pages/vibe-search.html" class="gap-2" aria-label="Vibe search">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <span>Vibe Search</span>
            <span class="badge badge-sm badge-accent">AI</span>
          </a>
        </li>
      </ul>

      <div class="divider"></div>

      <!-- Secondary Navigation -->
      <ul class="space-y-1">
        <li>
          <a href="/pages/usage.html" class="gap-2" aria-label="API usage and costs">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
            <span>Usage</span>
          </a>
        </li>
        <li>
          <a href="/pages/settings.html" class="gap-2" aria-label="Application settings">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Settings</span>
          </a>
        </li>
      </ul>

      <div class="divider"></div>

      <!-- Stats (bottom) -->
      <div class="mt-auto px-2">
        <div class="stats stats-vertical shadow mb-4">
          <div class="stat py-2">
            <div class="stat-title text-xs">Budget</div>
            <div class="stat-value text-sm" id="budget-stat">$0.00</div>
            <div class="stat-desc text-xs" id="budget-limit">of $10.00</div>
          </div>
        </div>

        <!-- Quick Upload Button -->
        <button class="btn btn-primary btn-block gap-2" onclick="openUploadModal()" aria-label="Upload new sample">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
          <span>Upload Sample</span>
        </button>
      </div>
    </aside>
  </div>
</div>

<script>
  // Update sidebar stats from API
  async function updateSidebarStats() {
    try {
      // Fetch sample count
      const samplesRes = await fetch('/api/v1/samples?limit=1');
      if (samplesRes.ok) {
        const samplesData = await samplesRes.json();
        document.getElementById('sample-count').textContent = samplesData.total || 0;
      }

      // Fetch kit count (if endpoint exists)
      try {
        const kitsRes = await fetch('/api/v1/kits?limit=1');
        if (kitsRes.ok) {
          const kitsData = await kitsRes.json();
          document.getElementById('kit-count').textContent = kitsData.total || 0;
        }
      } catch (e) {
        // Kits endpoint may not exist yet
        document.getElementById('kit-count').textContent = '0';
      }

      // Fetch budget data
      try {
        const budgetRes = await fetch('/api/v1/public/usage/summary');
        if (budgetRes.ok) {
          const budgetData = await budgetRes.json();
          const remaining = budgetData.budget?.remaining || 0;
          const limit = budgetData.budget?.max_cost_per_request || 10;
          document.getElementById('budget-stat').textContent = '$' + remaining.toFixed(2);
          document.getElementById('budget-limit').textContent = 'of $' + limit.toFixed(2);
        }
      } catch (e) {
        // Budget endpoint may not exist
        console.log('Budget data not available');
      }
    } catch (error) {
      console.error('Error updating sidebar stats:', error);
    }
  }

  // Update stats on load and every 30 seconds
  updateSidebarStats();
  setInterval(updateSidebarStats, 30000);

  // Global search functionality
  document.getElementById('global-search')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      const query = this.value.trim();
      if (query) {
        window.location.href = `/pages/samples.html?search=${encodeURIComponent(query)}`;
      }
    }
  });

  // Open upload modal (will be implemented based on page)
  function openUploadModal() {
    // Check if we're on samples page with modal
    if (typeof openUploadDrawer === 'function') {
      openUploadDrawer();
    } else {
      // Redirect to samples page
      window.location.href = '/pages/samples.html';
    }
  }
</script>

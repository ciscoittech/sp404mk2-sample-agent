# List Sample Tasks Command

**Command**: `/list-sample-tasks`

Displays all active sample collection tasks with their status, specialist progress, and collection health metrics.

## Usage

```bash
/list-sample-tasks
```

## Implementation

You are a Music Production coordinator providing comprehensive sample collection overview. When this command is executed:

### Phase 1: Discover Active Tasks
1. **Query GitHub for open sample collection issues** (label: `agent-task`)
2. **Scan samples directory for active workspaces**
3. **Check agent queue for running processes**
4. **Gather metadata from each collection**

### Phase 2: Health Assessment
For each collection task, check:
1. **Collection progress**: Samples collected vs target
2. **Quality metrics**: Average scores, approval rates
3. **Specialist status**: Reviews completed, pending decisions
4. **Agent activity**: Current phase, last activity
5. **Storage usage**: Disk space per collection

### Phase 3: Format Output
Present information in structured format:
1. **Summary header** with total collections
2. **Individual task details** with progress bars
3. **Specialist activity indicators**
4. **Quality metrics and alerts**
5. **Recommended actions**

## Expected Output Format

```
üéµ Active Sample Collections (4 total)
=====================================

üìÅ Task #123: Jazz drum breaks from Blue Note Records
üéØ Target: 50 samples | üìä Collected: 42 | ‚úÖ Approved: 35
üè∑Ô∏è  Labels: drums, jazz, vintage, 1960s
üë• Specialists: Music Historian, DJ/Beatmaker, Sound Engineer
üìà Progress: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 84% (Review phase)
‚≠ê Quality: 8.5/10 average | üéß BPM Range: 85-115

Specialist Status:
  üéì Music Historian: ‚úÖ 42/42 reviewed (9.2/10 avg)
  üéß DJ/Beatmaker: üîÑ 38/42 reviewed (8.3/10 avg)
  üîß Sound Engineer: üîÑ 35/42 reviewed (8.0/10 avg)

Agent Activity:
  ‚úÖ Collector: Complete (47 sources found)
  ‚úÖ Downloader: Complete (42 samples acquired)
  ‚úÖ Analyzer: Complete (BPM/key detection done)
  üîÑ Reporter: Creating review queue...

üíæ Storage: 1.2 GB | üïê Last activity: 5 min ago
üéØ Next: Complete specialist reviews ‚Üí Human curation

---

üìÅ Task #124: Vintage Rhodes sounds from soul records
üéØ Target: 30 samples | üìä Collected: 28 | ‚úÖ Approved: 15
üè∑Ô∏è  Labels: keys, soul, rhodes, 1970s
üë• Specialists: Keyboard Player, Genre Expert (Soul), Sound Engineer
üìà Progress: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë 60% (Analysis phase)
‚≠ê Quality: 7.8/10 average | üéπ Keys: C, F, Bb dominant

Specialist Status:
  üéπ Keyboard Player: üîÑ 20/28 reviewed (8.1/10 avg)
  üéµ Genre Expert: ‚è≥ Waiting for samples
  üîß Sound Engineer: üîÑ 15/28 reviewed (7.5/10 avg)

Agent Activity:
  ‚úÖ Collector: Complete (32 sources found)
  ‚úÖ Downloader: Complete (28 samples acquired)
  üîÑ Analyzer: Key detection 75% complete
  ‚è≥ Reporter: Pending

üíæ Storage: 856 MB | üïê Last activity: 12 min ago
‚ö†Ô∏è Alert: 3 samples need re-analysis (corrupted key data)

---

üìÅ Task #125: Lo-fi hip hop vocal chops
üéØ Target: 40 samples | üìä Collected: 12 | ‚úÖ Approved: 5
üè∑Ô∏è  Labels: vocals, lo-fi, hip-hop, chops
üë• Specialists: Genre Expert (Lo-fi), DJ/Beatmaker, Sound Engineer
üìà Progress: ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 30% (Collection phase)
‚≠ê Quality: 7.2/10 average | üé§ Types: Female (8), Male (4)

Specialist Status:
  üéµ Genre Expert: ‚úÖ 12/12 reviewed (7.5/10 avg)
  üéß DJ/Beatmaker: üîÑ 8/12 reviewed (7.0/10 avg)
  üîß Sound Engineer: ‚è≥ Waiting for more samples

Agent Activity:
  üîÑ Collector: Searching additional sources...
  ‚è∏Ô∏è Downloader: Paused (waiting for sources)
  ‚è≥ Analyzer: Pending
  ‚è≥ Reporter: Pending

üíæ Storage: 124 MB | üïê Last activity: 2 hours ago
‚ùå Issue: Limited sources found, considering scope adjustment

---

üìÅ Task #126: Brazilian percussion loops [DRAFT]
üéØ Target: 25 samples | üìä Collected: 0 | ‚úÖ Approved: 0
üè∑Ô∏è  Labels: percussion, world, brazilian, loops
üë• Specialists: Music Historian, Genre Expert (Brazilian), Crate Digger
üìà Progress: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0% (Planning phase)
‚≠ê Quality: N/A | ü•Å Instruments: Planned

Specialist Status:
  üéì Music Historian: ‚è≥ Awaiting samples
  üåé Genre Expert: üìù Creating source list
  üì¶ Crate Digger: üîç Researching archives

Agent Activity:
  ‚è≥ All agents pending task start

üíæ Storage: 0 MB | üïê Created: 1 day ago
üí° Ready to start: Run /process-sample-task 126

=====================================
üìä COLLECTION SUMMARY
=====================================

Total Active Tasks: 4
Total Samples Collected: 82/145 (57%)
Average Quality Score: 7.9/10
Total Storage Used: 2.2 GB

By Status:
  üîÑ In Progress: 3
  üìù Planning: 1
  ‚úÖ Ready for Review: 2
  ‚è∏Ô∏è Paused: 1

By Genre:
  üéµ Jazz: 1 task (42 samples)
  üéµ Soul: 1 task (28 samples)
  üéµ Hip-Hop: 1 task (12 samples)
  üéµ World: 1 task (0 samples)

üö® Attention Required:
============================
‚Ä¢ Task #124: Fix corrupted key detection data
‚Ä¢ Task #125: Source shortage - consider expanding search
‚Ä¢ Task #123: Complete specialist reviews for human curation

üí° Quick Actions:
================
‚Ä¢ /process-sample-task 126    - Start Brazilian percussion
‚Ä¢ /review-samples 123         - Begin human curation
‚Ä¢ /fix-analysis 124          - Re-run key detection
‚Ä¢ /expand-search 125         - Find more vocal sources
```

## Health Indicators

### Status Icons:
- ‚úÖ **Green**: Complete/passing
- üîÑ **Blue**: In progress
- ‚è≥ **Gray**: Pending/waiting
- ‚ö†Ô∏è **Yellow**: Warning/attention needed
- ‚ùå **Red**: Error/blocked
- ‚è∏Ô∏è **Paused**: Temporarily halted

### Progress Phases:
1. **Planning (0-10%)**: Source identification
2. **Collection (10-40%)**: Downloading samples
3. **Analysis (40-60%)**: Technical processing
4. **Review (60-90%)**: Specialist evaluation
5. **Curation (90-100%)**: Human approval

## Detailed Metrics Calculation

### Quality Score Aggregation:
```python
def calculate_quality_metrics(task):
    specialist_scores = []
    for specialist in task.specialists:
        if specialist.reviews:
            avg_score = sum(specialist.reviews) / len(specialist.reviews)
            specialist_scores.append(avg_score)
    
    overall_quality = sum(specialist_scores) / len(specialist_scores)
    return {
        'overall': overall_quality,
        'by_specialist': specialist_scores,
        'approved_rate': task.approved / task.collected
    }
```

### Collection Health Check:
```python
health_checks = {
    'progress_rate': check_collection_velocity,
    'quality_trend': analyze_quality_trajectory,
    'specialist_consensus': measure_agreement,
    'technical_issues': count_processing_errors,
    'storage_efficiency': calculate_compression_ratio
}
```

### Activity Monitoring:
```python
def get_agent_activity(task_id):
    return {
        'last_activity': get_latest_timestamp(),
        'active_agent': get_current_agent(),
        'phase_duration': calculate_phase_time(),
        'estimated_completion': predict_finish_time()
    }
```

## Specialist Activity Details

### Specialist Workload View:
```
üë• Specialist Workload Summary
==============================

üéì Music Historian (2 active tasks)
   ‚Ä¢ Task #123: 42/42 complete (9.2/10 avg) ‚úÖ
   ‚Ä¢ Task #126: Pending start ‚è≥
   ‚Ä¢ Total reviews: 42 | Avg time: 2.3 min/sample

üéß DJ/Beatmaker (3 active tasks)
   ‚Ä¢ Task #123: 38/42 in progress (8.3/10 avg) üîÑ
   ‚Ä¢ Task #125: 8/12 in progress (7.0/10 avg) üîÑ
   ‚Ä¢ Task #126: Pending start ‚è≥
   ‚Ä¢ Total reviews: 46 | Avg time: 1.8 min/sample

üîß Sound Engineer (4 active tasks)
   ‚Ä¢ Task #123: 35/42 in progress (8.0/10 avg) üîÑ
   ‚Ä¢ Task #124: 15/28 in progress (7.5/10 avg) üîÑ
   ‚Ä¢ Task #125: Awaiting samples ‚è≥
   ‚Ä¢ Task #126: Pending start ‚è≥
   ‚Ä¢ Total reviews: 50 | Avg time: 3.1 min/sample
```

## Integration Features

### Real-Time Updates:
```bash
# Watch mode for live updates
/list-sample-tasks --watch

# Filter by status
/list-sample-tasks --status=review

# Sort by priority
/list-sample-tasks --sort=quality

# Export metrics
/list-sample-tasks --export=csv
```

### Quick Filters:
1. **By Genre**: Show only specific music styles
2. **By Specialist**: Tasks assigned to specific expert
3. **By Phase**: Collection/Analysis/Review/etc
4. **By Quality**: Above/below threshold
5. **By Age**: Recently updated/stale tasks

## Database Queries

### Task Status Query:
```sql
SELECT 
    t.issue_number,
    t.title,
    t.target_count,
    COUNT(s.id) as collected,
    COUNT(CASE WHEN s.status = 'approved' THEN 1 END) as approved,
    AVG(s.quality_score) as avg_quality,
    MAX(s.created_at) as last_activity
FROM tasks t
LEFT JOIN samples s ON t.id = s.task_id
WHERE t.status = 'active'
GROUP BY t.id
ORDER BY last_activity DESC;
```

### Specialist Performance:
```sql
SELECT 
    sp.name as specialist,
    COUNT(DISTINCT sr.task_id) as active_tasks,
    COUNT(sr.id) as total_reviews,
    AVG(sr.score) as avg_score,
    AVG(sr.review_time) as avg_time
FROM specialists sp
JOIN specialist_reviews sr ON sp.id = sr.specialist_id
WHERE sr.created_at > datetime('now', '-7 days')
GROUP BY sp.id;
```

## Alert System

### Automated Alerts:
1. **Quality dropping**: Average score trending down
2. **Stale collections**: No activity > 24 hours
3. **Storage warnings**: Approaching limits
4. **Specialist bottleneck**: Reviews backing up
5. **Source exhaustion**: Can't find more samples

### Alert Examples:
```
üö® ALERTS (3)
============

‚ö†Ô∏è Task #124: Key detection failing (3 errors)
   ‚Üí Suggested action: /fix-analysis 124

‚ö†Ô∏è Task #125: Collection stalled at 30%
   ‚Üí Suggested action: /expand-search 125

‚ö†Ô∏è Storage: 85% full (17 GB / 20 GB)
   ‚Üí Suggested action: /cleanup-rejected-samples
```

## Performance Optimization

### Caching Strategy:
1. **Cache task summaries** (5 minute TTL)
2. **Cache specialist scores** (10 minute TTL)
3. **Parallel metric calculation**
4. **Incremental updates** for large collections

### Display Optimization:
```python
# Paginate large result sets
def display_tasks(limit=10, offset=0):
    tasks = fetch_active_tasks(limit, offset)
    return format_task_display(tasks)

# Progressive loading
def load_task_details(task_id, detail_level='summary'):
    if detail_level == 'summary':
        return get_cached_summary(task_id)
    else:
        return fetch_full_details(task_id)
```

## Success Criteria

The command is successful when:
1. ‚úÖ All active tasks discovered and displayed
2. ‚úÖ Accurate progress percentages shown
3. ‚úÖ Specialist statuses correctly reflected
4. ‚úÖ Quality metrics properly calculated
5. ‚úÖ Storage usage accurately reported
6. ‚úÖ Alerts for issues prominently displayed
7. ‚úÖ Quick action suggestions relevant
8. ‚úÖ Performance acceptable (<3 seconds)
9. ‚úÖ Visual hierarchy clear and scannable
10. ‚úÖ Next steps obvious for each task

## Error Handling

### Common Issues:
1. **GitHub API unavailable**: Show cached data with warning
2. **Database query timeout**: Limit result set, show partial
3. **Corrupted workspace**: Offer repair options
4. **Missing metadata**: Regenerate from files

### Graceful Degradation:
- If GitHub fails, show local data only
- If database slow, show basic stats only
- If workspace corrupted, mark for repair
- Always show something useful

This command provides a comprehensive dashboard for managing multiple sample collection workflows, giving clear visibility into progress, quality, and next actions needed.